---
import Layout from "../../layouts/LayoutBlog.astro";

// Exporta una función getStaticPaths para generar una página por cada página de posts.
export async function getStaticPaths({ paginate }) {
    // Obtener todos los posts
    const allPosts = await Astro.glob("../../posts/*.md");
    // Ordenar los posts por fecha, del más reciente al más antiguo
    const sortedPosts = allPosts.sort(
        (a, b) =>
            new Date(b.frontmatter.date).valueOf() -
            new Date(a.frontmatter.date).valueOf()
    );

    // Devuelve una colección paginada de rutas para que Astro las construya.
    return paginate(sortedPosts, { pageSize: 10 });
}

// Todos los datos paginados se pasan en la prop `page`
const { page } = Astro.props;

// Función tipada para extraer el slug
function getSlug(file: string): string {
    const fileName = file.split("/").pop() || "";
    return fileName.split(".")[0] || "";
}

// Definición de tipo para un post
interface Post {
    file: string;
    frontmatter: {
        title: string;
        description: string;
        date: string;
        [key: string]: any;
    };
}
---

<Layout 
title={`Blog de Desarrollo Web y Marketing Digital - Página ${page.currentPage}`}
description="Artículos prácticos para profesionales: desarrollo web, copywriting, landing pages y estrategias de conversión."
keywords="blog desarrollo web, blog marketing digital, WordPress, copywriter, crear landing pages, estrategias ventas online"
>

    <main class="main">
        <div class="contenedor">
            <h1>Todos las publicaciones</h1>
            <ul>
                {page.data.map((post: any) => {
                    const slug = getSlug(post.file);
                    return (
                        <li class="blog-list-item">
                            <h2 class="blog-title">
                                <a 
                                    href={`/blog/${slug}`}
                                    class="text-green-700 hover:underline"
                                >
                                    {post.frontmatter.title}
                                </a>
                            </h2>
                            <p class="text-gray-500 mb-4 blog-excerpt">
                                {post.frontmatter.description}
                            </p>
                            <a 
                                href={`/blog/${slug}`}
                                class="text-green-700 text-2xl hover:underline blog-read-more"
                            >
                                Leer más →
                            </a>
                        </li>
                    );
                })}
            </ul>

            <!-- Paginación -->
            <div class="pagination">
                {page.url.prev && <a href={page.url.prev} class="prev">&laquo; Anteriores</a>}
                <span class="page-indicator">Página {page.currentPage} de {page.lastPage}</span>
                {page.url.next && <a href={page.url.next} class="next">Siguientes &raquo;</a>}
            </div>
        </div>
    </main>
</Layout>

<style>
    .contenedor{
        max-width: 1000px;
        margin: 0 auto;
        padding: 0 20px;
    }
    h1{
        color: #047857;
        padding-top: 20px;
        padding-bottom: 20px;
        margin-left: 20px;
    }   
.blog-list-item {
    margin-bottom: 2.5rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #eaeaea;
}

.blog-title {
    
    margin-bottom: 1rem;
}

.blog-excerpt {
  
    line-height: 1.6;
    color: #666;
    margin-bottom: 1.5rem;
}

.blog-read-more {
    font-weight: 500;
    display: inline-block;
    transition: transform 0.2s ease;
}

.blog-read-more:hover {
    transform: translateX(5px);
}

/* Estilos para mantener tu esquema de colores existente */
.text-green-700 {
    color: #047857;
}

.hover\:underline:hover {
    text-decoration: underline;
}

.text-gray-500 {
    color: #6b7280;
}

.text-2xl {
   
    line-height: 2rem;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* Estilos de Paginación */
.pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2rem;
    padding: 1rem 0;
}

.pagination a {
    color: #047857;
    text-decoration: none;
    padding: 0.5rem 1rem;
    border: 1px solid #047857;
    border-radius: 5px;
    transition: background-color 0.3s, color 0.3s;
}

.pagination a:hover {
    background-color: #047857;
    color: white;
}

.page-indicator {
    color: #6b7280;
    font-size: 1rem;
}
</style>